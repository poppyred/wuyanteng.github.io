<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>大数据ganglia集群监控-centos6 | Gary Wu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="大数据高级运维hadoopGanglia" />
  
  
  
  
  <meta name="description" content="Ganglia单群集部署Ganglia集群监控 Ganglia是由UC Berkeley发起的一个开源监控项目，设计用于监控数以千几的节点。每台服务器都运行一个收集和发送监控数据名为gmond的守护进程。它将从操作系统和指定主机中收集。 接收所有监控数据的主机可以显示这些数据并且可以将这些数据的精简表单传递到层次结构中。正因为有这种层次架构模式，使ganglia可以实现良好的扩展。Gmond带来的">
<meta name="keywords" content="大数据,高级运维,hadoop,Ganglia">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据Ganglia集群监控-CentOS6">
<meta property="og:url" content="https://wuyanteng.github.io/2017/06/14/大数据Ganglia集群监控-CentOS6/index.html">
<meta property="og:site_name" content="Gary Wu">
<meta property="og:description" content="Ganglia单群集部署Ganglia集群监控 Ganglia是由UC Berkeley发起的一个开源监控项目，设计用于监控数以千几的节点。每台服务器都运行一个收集和发送监控数据名为gmond的守护进程。它将从操作系统和指定主机中收集。 接收所有监控数据的主机可以显示这些数据并且可以将这些数据的精简表单传递到层次结构中。正因为有这种层次架构模式，使ganglia可以实现良好的扩展。Gmond带来的">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-07-04T11:02:54.065Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大数据Ganglia集群监控-CentOS6">
<meta name="twitter:description" content="Ganglia单群集部署Ganglia集群监控 Ganglia是由UC Berkeley发起的一个开源监控项目，设计用于监控数以千几的节点。每台服务器都运行一个收集和发送监控数据名为gmond的守护进程。它将从操作系统和指定主机中收集。 接收所有监控数据的主机可以显示这些数据并且可以将这些数据的精简表单传递到层次结构中。正因为有这种层次架构模式，使ganglia可以实现良好的扩展。Gmond带来的">
  
    <link rel="alternate" href="/atom.xml" title="Gary Wu" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-大数据Ganglia集群监控-CentOS6" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      大数据Ganglia集群监控-CentOS6
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/06/14/大数据Ganglia集群监控-CentOS6/" class="article-date">
	  <time datetime="2017-06-14T07:26:39.000Z" itemprop="datePublished">2017-06-14</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Ganglia单群集部署"><a href="#Ganglia单群集部署" class="headerlink" title="Ganglia单群集部署"></a>Ganglia单群集部署</h2><h4 id="Ganglia集群监控"><a href="#Ganglia集群监控" class="headerlink" title="Ganglia集群监控"></a>Ganglia集群监控</h4><blockquote>
<p>Ganglia是由UC Berkeley发起的一个开源监控项目，设计用于监控数以千几的节点。每台服务器都运行一个收集和发送监控数据名为gmond的守护进程。它将从操作系统和指定主机中收集。</p>
<p>接收所有监控数据的主机可以显示这些数据并且可以将这些数据的精简表单传递到层次结构中。正因为有这种层次架构模式，使ganglia可以实现良好的扩展。Gmond带来的系统负载非常小，这使得它成为集群中各个服务器上运行一段代码而不会影响用户性能。</p>
<a id="more"></a>
<p>Ganglia主要用来监控系统性能的软件，通过曲线很容易见到每个节点的工作状态，对合理调整，分配系统资源，提高系统整体性能起到重要作用，支持浏览器方式访问，但不能监控节点硬件技术指标。Ganglia是分布式的监控系统。</p>
</blockquote>
<h4 id="Ganglia的组件"><a href="#Ganglia的组件" class="headerlink" title="Ganglia的组件"></a>Ganglia的组件</h4><blockquote>
<p>ganglia由三个组件构成</p>
<ul>
<li><strong>gmond</strong> :（client）是一个守护进程，他运行在每一个需要监测的节点上，收集监测统计，发送和接受在同一个组播或单播通道上的统计信息。</li>
<li><strong>gmetad</strong>:（server端）也是一个守护进程，他定期检查gmonds，从那里拉取数据，并将他们的指标存储在RRD存储引擎中。他可以查询多个集群并聚合指标，然后生成并在用户界面的web前端展示。</li>
<li><strong>ganglia-web</strong> :（server端）顾名思义，他应该安装在有gmetad运行的机器上，以便读取RRD文件。 </li>
</ul>
</blockquote>
<h4 id="Ganglia-工作模式"><a href="#Ganglia-工作模式" class="headerlink" title="Ganglia 工作模式"></a>Ganglia 工作模式</h4><blockquote>
<p>Ganglia收集数据可以工作在单播或多播模式下，默认为多播模式<br>单播：发送自己收集到的监控数据到特定的一台或几台服务器上，可以跨网段。<br>多播：发送自己收集到的监控数据到同一网段所有的服务器上，同时收集同一网段的所有服务器发送过来的监控数据。因为是以广播包的形式发送，因此需要在同一网段内，但同一网段内，又可以定义不同的发送通道。</p>
<p>工作模式：<a href="http://www.ttlsa.com/wp-content/uploads/2011/11/ganglia-1.jpg" target="_blank" rel="noopener">图例</a></p>
</blockquote>
<h4 id="环境结构说明"><a href="#环境结构说明" class="headerlink" title="环境结构说明"></a>环境结构说明</h4><blockquote>
<p>现在有3台机器用来测试搭建Ganglia监控集群环境，采用多播的方式来监控各机器运行情况。</p>
<p>我以server-25为主节点（它上面部署监控服务端）</p>
<p>首先，在server-25 hosts 中配置主机信息。目的是为了读取各机器的主机名而不是IP。</p>
<pre><code>cat  &gt;&gt; /etc/hosts &lt;&lt; EOF

192.168.0.25 server-25
192.168.0.26 client1-26
192.168.0.27 client2-27

EOF
</code></pre></blockquote>
<h4 id="更换epel源-推荐"><a href="#更换epel源-推荐" class="headerlink" title="更换epel源(推荐)"></a>更换epel源(推荐)</h4><blockquote>
<p>该epel源内置大量优秀的软件，如果默认的yum源找不到你要安装的软件，那么这个epel源很适合你。</p>
</blockquote>
<pre><code>安装epel源(服务端/客户端运行)
yum update &amp;&amp; yum install epel-release 
</code></pre><h4 id="服务端安装"><a href="#服务端安装" class="headerlink" title="服务端安装"></a>服务端安装</h4><pre><code>安装gmetad（服务端运行）
yum install -y ganglia-gmetad ganglia-devel 

安装依赖图形软件rrdtool
yum erase rrdtool -y
yum install -y rrdtool

安装httpd服务器(用于搭建php网页服务器)
yum install -y httpd

安装ganglia-web及php
yum install -y ganglia-web php
</code></pre><h4 id="客户端安装"><a href="#客户端安装" class="headerlink" title="客户端安装"></a>客户端安装</h4><pre><code>安装gmond(所有客户端运行)
yum install -y ganglia-gmond
</code></pre><h4 id="软件安装目录说明"><a href="#软件安装目录说明" class="headerlink" title="软件安装目录说明"></a>软件安装目录说明</h4><pre><code>ganglia配置文件目录：/etc/ganglia
rrd数据库存放目录：/var/lib/ganglia/rrds
httpd主站点目录：/var/www/html
ganglia-web安装目录：/usr/share/ganglia
ganglia-web配置目录：/etc/httpd/conf.d/ganglia.conf
</code></pre><h4 id="配置服务端-gmetad"><a href="#配置服务端-gmetad" class="headerlink" title="配置服务端(gmetad)"></a>配置服务端(gmetad)</h4><pre><code>将ganglia-web的站点目录连接到httpd主站点目录
ln -s /usr/share/ganglia/ /var/www/html/

修改httpd主站点目录下ganglia站点目录的访问权限
chown -R apache:apache /var/www/html/ganglia

修改ganglia站点目录访问权限属主属组为apache
chmod -R 755 /var/www/html/ganglia

修改rrd数据库存放目录访问权限属主属组为ganglia
chown -R ganglia:ganglia /var/lib/ganglia/rrds
</code></pre><pre><code>修改ganglia-web的访问权限
cat  /etc/httpd/conf.d/ganglia.conf

       Alias /ganglia /usr/share/ganglia

       &lt;Location /ganglia&gt;
          Order deny,allow
          Deny from all
          #Allow from 127.0.0.1
          #Allow from ::1
          allow from all
          # Allow from .example.com
       &lt;/Location&gt;
</code></pre><blockquote>
<p>配置/etc/ganglia/gmetad.conf</p>
</blockquote>
<pre><code>data_source &quot;hadoop_cluster_yarn&quot; 30 host1:8649 host2:8649
（1）data_source参数定义了集群名字，以及集群中的节点。由于采用multicast模式，每台gmond节点都有本Cluster1内节点机器的所有监控数据，因此不需要把所有节点写入data_source中。建议写入不低于2个，在host1节点死机的时候，会自动找host2节点取数据。
(2)中间的30，单位是秒。意思是30s轮询向后面的node查询信息然后交给rrd画图。如果不加30参数，默认15s一个轮询。

setuid_username ganglia 
该用户名需要与/var/lib/ganglia/rrds/属主保持一致，这样能确保读写没问题。否则启动gmetad会出现：gmetad dead but subsys locked的错误

xml_port 8651
xml_port定义了一个收集数据汇总的交互端口，如果不指定，默认是8651，可以通过telnet这个端口得到监控管理端收集到的客户端的所有数据。

interactive_port 8652
interactive_port 定义了Web端获取数据的端口，这个端口在配置Ganglia的web监控界面时需要指定。

rrd_rootdir &quot;/var/lib/ganglia/rrds&quot;
rrd_rootdir参数定义了rrd数据库的存放路径，gmetad收集到监控数据后，会更新到该目录下的对应的rrd数据库中。

gridname &quot;Hadoop&quot;  定义grad名称，该名称会显示在Web界面中

上面通过data_source参数定义了一个监控集群，如果要监控多个应用系统，可以通过如下方式定义：
data_source &quot;my cluster&quot; 10 localhost  my.machine.edu:8649  1.2.3.5:8655
data_source &quot;my grid&quot; 50 1.3.4.7:8655 grid.org:8651 grid-backup.org:8651
data_source &quot;another source&quot; 1.3.4.7:8655  1.3.4.8
在定义集群节点的时候，可以采用主机名、IP地址等形式，也可以加端口，如果不加端口的话，默认是8649端口，同时可以设定采集数据的频率，如上面的“10 localhost、50 1.3.4.7:8655”等，分别表示每隔10秒钟、50秒钟采集一次数据。
</code></pre><pre><code>case_sensitive_hostnames 1

在gmetad之前版本中，RRD文件区分主机名大小写，但是现在已经有所改变。如果希望继续使用Ganglia 3.2之前版本创建的RRD文件，将该值设置为1。

注意：如果该参数非1，将会导致“浏览器访问ganglia出现各个节点的表格显示“ganglia no matching metrics detected”错误，内页不出图。
</code></pre><h4 id="配置客户端-gmond"><a href="#配置客户端-gmond" class="headerlink" title="配置客户端(gmond)"></a>配置客户端(gmond)</h4><pre><code>配置文件
vim /etc/ganglia/gmond.conf
</code></pre><pre><code>#global部分
globals {
  daemonize = yes        #以后台的方式运行
  setuid = yes
  user = ganglia         #运行gmond的用户
  debug_level = 0        #调试级别。如果有问题，可以修改值为10看启动信息
  max_udp_msg_len = 1472
  mute = no             #哑巴，本节点将不会再广播任何自己收集到的数据到网络上
  deaf = no             #聋子，本节点将不再接收任何其他节点广播的数据包
  allow_extra_data = yes
  host_dmax = 0 /*secs */
  cleanup_threshold = 300 /*secs */
  gexec = no            #是否使用gexec
  send_metadata_interval = 0
}


#cluster部分
cluster {
  name = &quot;hadoop_cluster_yarn&quot;     #本节点属于哪个cluster，该值需要和服务端配置文件data_source一致。
  owner = &quot;apache&quot;          #谁是该节点的所有者
  latlong = &quot;unspecified&quot;   #类似于地球上的坐标，经度、纬度？
  url = &quot;unspecified&quot;
}


#host部分
host {
  location = &quot;unspecified&quot;  #显示，可以起一个描述机器位置的信息
 }


#udp send部分
udp_send_channel {           #udp包的发送通道 
  mcast_join = 239.2.11.71   #多播。其中239.2.11.71是保留地址，官方默认要求，无需修改
  #host = 192.168.0.26       #如果使用单播模式（定点发定点收），不建议
  #单播需要改为比如 host = 192.168.0.26(指定ganglia客户端 IP地址)，单播模式下也可以配置多个udp_send_channel
  port = 8649                #监听端口
  ttl = 1
}

udp_recv_channel {           #接收udp包配置
  mcast_join = 239.2.11.71   #同样工作在239.2.11.71通道下
  port = 8649                #监听端口
  bind = 239.2.11.71         #绑定
}


tcp_accept_channel {
  port = 8649               #通过tcp协议监听的端口，远端可以通过链接8649端口得到监控数据
}
</code></pre><h4 id="管理ganglia"><a href="#管理ganglia" class="headerlink" title="管理ganglia"></a>管理ganglia</h4><pre><code>所有配置操作完成后，即可启动ganglia服务了，首先在监控管理端启动gmetad服务：
/etc/init.d/gmetad start

接着启动apache的web服务：
/etc/init.d/httpd start

最后在每个客户端启动gmond服务：
/etc/init.d/gmond start
</code></pre><h4 id="你可能会遇到的问题"><a href="#你可能会遇到的问题" class="headerlink" title="你可能会遇到的问题"></a>你可能会遇到的问题</h4><pre><code>1. 服务器端启动ganglia后，查看状态出现错误
/etc/init.d/gmetad status
gmetad dead but subsys locked

cat  /etc/ganglia/gmetad.conf
setuid_username ganglia 
该用户名需要与/var/lib/ganglia/rrds/属主保持一致，这样能确保读写没问题。否则启动gmetad会出现：gmetad dead but subsys locked的错误
</code></pre><pre><code>2. Web访问ganglia: http://10.0.10.25/ganglia/
出现错误：There was an error collecting ganglia data (127.0.0.1:8652): fsockopen error

关闭selinux！
关闭selinux！
关闭selinux！
重要事情说三遍！！！
</code></pre><pre><code>3. 由于系统时间不对导致的问题
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
yum install -y ntpdate
ntpdate time.windows.com
/etc/init.d/gmetad  restart
</code></pre><h4 id="debug排错"><a href="#debug排错" class="headerlink" title="debug排错"></a>debug排错</h4><pre><code>善于使用软件自身提供的debug功能来查找原因

vim  /etc/ganglia/gmetad.conf

debug_level 10      //启用该参数，重启服务后会打印运行log到屏幕
</code></pre><h4 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h4><blockquote>
<p><a href="http://192.168.0.25/ganglia" target="_blank" rel="noopener">http://192.168.0.25/ganglia</a></p>
</blockquote>
<h2 id="Ganglia多个群集-部署（多播模式）"><a href="#Ganglia多个群集-部署（多播模式）" class="headerlink" title="Ganglia多个群集-部署（多播模式）"></a>Ganglia多个群集-部署（多播模式）</h2><blockquote>
<p>多个群集架构图：<a href="https://jablonskis.org/images/2011-05-19-monitoring-multiple-clusters-using-ganglia/ganglia_multiple_clusters1.png" target="_blank" rel="noopener">图例</a></p>
</blockquote>
<blockquote>
<p>环境：</p>
<p>ClusterOne节点上有4个节点: node0.c1 , node1.c1 , node2.c1 , node3.c1</p>
<p>ClusterTwo节点上有4个节点: node0.c2 , node1.c2 , node2.c2 , node3.c2</p>
<p>ClusterThree节点上有4个节点：node0.c3 , node1.c3 , node2.c3 , node3.c3</p>
</blockquote>
<ul>
<li><p>ClusterOne上面的node0.c1部署（node1.c1 , node2.c1 , node3.c1配置相同）</p>
<pre><code># /etc/gmond.conf - on ClusterOne
cluster {
  name = &quot;ClusterOne&quot;        //这个通道名字不能与其他群集重复，ClusterOne集群端口也要确保唯一，此处是：8661
  owner = &quot;unspecified&quot;
  latlong = &quot;unspecified&quot;
  url = &quot;unspecified&quot;
}

udp_send_channel {
  mcast_join = 239.2.11.71
  port = 8661
  ttl = 1
}

udp_recv_channel {
  mcast_join = 239.2.11.71
  port = 8661
  bind = 239.2.11.71
}

tcp_accept_channel {
  port = 8661
}
</code></pre><p>​</p>
</li>
<li><p>ClusterTwo上面的node0.c2部署（node1.c2 , node2.c2 , node3.c2配置相同）</p>
<pre><code># /etc/gmond.conf - on ClusterTwo
cluster {
  name = &quot;ClusterTwo&quot;           //这个通道名字不能与其他群集重复，ClusterOne集群端口也要确保唯一，此处是：8662
  owner = &quot;unspecified&quot;
  latlong = &quot;unspecified&quot;
  url = &quot;unspecified&quot;
}

udp_send_channel {
  mcast_join = 239.2.11.71
  port = 8662
  ttl = 1
}

udp_recv_channel {
  mcast_join = 239.2.11.71
  port = 8662
  bind = 239.2.11.71
}

tcp_accept_channel {
  port = 8662
}
</code></pre><p>​</p>
</li>
<li><p>ClusterThree上面的node0.c3部署（node1.c3 , node2.c3 , node3.c3配置相同）</p>
<pre><code># /etc/gmond.conf - on ClusterThree
cluster {
  name = &quot;ClusterThree&quot;     //这个通道名字不能与其他群集重复，ClusterOne集群端口也要确保唯一，此处是：8663
  owner = &quot;unspecified&quot;
  latlong = &quot;unspecified&quot;
  url = &quot;unspecified&quot;
}

udp_send_channel {
  mcast_join = 239.2.11.71
  port = 8663
  ttl = 1
}

udp_recv_channel {
  mcast_join = 239.2.11.71
  port = 8663
  bind = 239.2.11.71
}

tcp_accept_channel {
  port = 8663
}
</code></pre></li>
<li><p>定义完node节点，最后配置ganglia服务端/etc/ganglia/gmetad.conf</p>
<pre><code># /etc/gmetad.conf 
data_source &quot;ClusterOne&quot; 30 node0.c1:8661 node1.c1:8661
data_source &quot;ClusterTwo&quot; 30 node0.c2:8662 node1.c2:8662
data_source &quot;ClusterThree&quot; 30 node3.c2:8663 node1.c3:8663

注：后面每个通道至少要写2个node信息，如果一个节点挂掉，另一个节点仍然能够提供本通道（cluster name）的统计信息gmetad，因为gmond节点在配置的UDP通道内交换统计信息。
</code></pre></li>
<li><p>最后重启服务端与node节点的服务即可。有问题开启debug</p>
<!-- more -->
</li>
</ul>
<h2 id="需求：服务器复用，Ganglia分别监控同1台机器"><a href="#需求：服务器复用，Ganglia分别监控同1台机器" class="headerlink" title="需求：服务器复用，Ganglia分别监控同1台机器"></a>需求：服务器复用，Ganglia分别监控同1台机器</h2><blockquote>
<p>需求：假如一台服务器上面同时安装了HDFS、Yarn和Spark，让Ganglia分别监控这台机器。</p>
<p>目的：是让大数据人员很清楚每台机器上面具体有什么业务。</p>
</blockquote>
<blockquote>
<p>方案：在客户端启用多个gmond进程。</p>
<p>比如我的案例：<br>默认配置文件gmond我定义为HDFS群集，复制gmond.conf为gmond-hdfs.conf， name=hdfs  port=8649(默认)<br>Yarn群集：复制gmond.conf并改名为gmond-yarn.conf，name=yarn  port=8650<br>Spark群集：复制gmond.conf并改名为gmond-spark.conf , name=spark  port=8651</p>
</blockquote>
<h4 id="实施方案"><a href="#实施方案" class="headerlink" title="实施方案"></a>实施方案</h4><pre><code>客户端启动多个gmond进程：

启动第一个HDFS gmond进程：
/usr/sbin/gmond -c /etc/ganglia/gmond-hdfs.conf -p /etc/ganglia/gmond-hdfs.pid

启动第二个yarn gmond进程：
/usr/sbin/gmond -c /etc/ganglia/gmond-yarn.conf -p /etc/ganglia/gmond-yarn.pid

启动第三个spark gmond进程：
/usr/sbin/gmond -c /etc/ganglia/gmond-spark.conf -p /etc/ganglia/gmond-spark.pid

如果有更多，方法类似，以此类推。

注意：配置文件内多个群集区分，多个群集之间，配置文件的name与port一定要区分，否则就串了

上面的启动命令最好放到脚本里面，开机一次性自启动 :)
</code></pre><h4 id="维护"><a href="#维护" class="headerlink" title="维护"></a>维护</h4><pre><code>每台机器多个gmond进程难免出现故障，可能某个gmond进程无法启动，总结为如下几点原因：
1. 检查gmond进程端口是否被其他程序占用， lsof -i:8649
2. 删除故障的gmond pid文件重新启动对应gmond服务
3. 检查gmond服务所在服务器是否已经开启selinux或iptables，根据实际情况进行端口开放。
</code></pre><h6 id="附加：gmond命令帮助"><a href="#附加：gmond命令帮助" class="headerlink" title="附加：gmond命令帮助"></a>附加：gmond命令帮助</h6><pre><code># gmond --help

gmond 3.7.2

The Ganglia Monitoring Daemon (gmond) listens to the cluster
message channel, stores the data in-memory and when requested
will output an XML description of the state of the cluster

Usage: gmond [OPTIONS]...

  -h, --help             Print help and exit
  -V, --version          Print version and exit
  -c, --conf=STRING      Location of gmond configuration file  
                           (default=`/etc/ganglia/gmond.conf&#39;)
  -l, --location=STRING  Location of this host in the cluster 
                           &#39;rack,rank,plane&#39;.  (default=`0,0,0&#39;)
  -d, --debug=INT        Debug level. If greater than zero, daemon will stay in 
                           foreground.  (default=`0&#39;)
  -f, --foreground       Run in foreground (don&#39;t daemonize)  (default=off)
  -t, --default_config   Print the default configuration to stdout and exit  
                           (default=off)
  -m, --metrics          Print the list of metrics this gmond supports  
                           (default=off)
  -b, --bandwidth        Calculate minimum bandwidth use for configuration  
                           (default=off)
  -r, --convert=STRING   Convert a 2.5.x configuration file to the new 3.x 
                           format
  -p, --pid-file=STRING  Write process-id to file
</code></pre><blockquote>
<p>最后的最后，贴下自己的测试环境Ganglia图形界面</p>
<p>Ganglia1: <a href="http://a1.qpic.cn/psb?/V141ZiIW1jTAHt/go.Os5wzTyNegv1XkdiPtwuU9VnWetf68bP.GvdmWB4!/b/dHUAAAAAAAAA&amp;bo=OwaAAgAAAAADB50!&amp;rf=viewer_4" target="_blank" rel="noopener">图例</a>   </p>
<p>Gagnlia2: <a href="http://a2.qpic.cn/psb?/V141ZiIW1jTAHt/x4Do9.vFDNa2bZtGue5cg72cNkQIy4QN9lbJ5EBbNiw!/b/dBgBAAAAAAAA&amp;bo=MwSAAgAAAAADB5c!&amp;rf=viewer_4" target="_blank" rel="noopener">图例</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ganglia/">Ganglia</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hadoop/">hadoop</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大数据/">大数据</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/高级运维/">高级运维</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/06/15/chkconfig自定义开机脚本-实现/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          chkconfig自定义开机脚本-实现
        
      </div>
    </a>
  
  
    <a href="/2017/06/14/读无字书-杯子取水/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">读无字书-杯子取水 </div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Ganglia单群集部署"><span class="nav-number">1.</span> <span class="nav-text">Ganglia单群集部署</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ganglia集群监控"><span class="nav-number">1.0.1.</span> <span class="nav-text">Ganglia集群监控</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ganglia的组件"><span class="nav-number">1.0.2.</span> <span class="nav-text">Ganglia的组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Ganglia-工作模式"><span class="nav-number">1.0.3.</span> <span class="nav-text">Ganglia 工作模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#环境结构说明"><span class="nav-number">1.0.4.</span> <span class="nav-text">环境结构说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#更换epel源-推荐"><span class="nav-number">1.0.5.</span> <span class="nav-text">更换epel源(推荐)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#服务端安装"><span class="nav-number">1.0.6.</span> <span class="nav-text">服务端安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#客户端安装"><span class="nav-number">1.0.7.</span> <span class="nav-text">客户端安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#软件安装目录说明"><span class="nav-number">1.0.8.</span> <span class="nav-text">软件安装目录说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置服务端-gmetad"><span class="nav-number">1.0.9.</span> <span class="nav-text">配置服务端(gmetad)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置客户端-gmond"><span class="nav-number">1.0.10.</span> <span class="nav-text">配置客户端(gmond)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#管理ganglia"><span class="nav-number">1.0.11.</span> <span class="nav-text">管理ganglia</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#你可能会遇到的问题"><span class="nav-number">1.0.12.</span> <span class="nav-text">你可能会遇到的问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#debug排错"><span class="nav-number">1.0.13.</span> <span class="nav-text">debug排错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#访问"><span class="nav-number">1.0.14.</span> <span class="nav-text">访问</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ganglia多个群集-部署（多播模式）"><span class="nav-number">2.</span> <span class="nav-text">Ganglia多个群集-部署（多播模式）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#需求：服务器复用，Ganglia分别监控同1台机器"><span class="nav-number">3.</span> <span class="nav-text">需求：服务器复用，Ganglia分别监控同1台机器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#实施方案"><span class="nav-number">3.0.1.</span> <span class="nav-text">实施方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#维护"><span class="nav-number">3.0.2.</span> <span class="nav-text">维护</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#附加：gmond命令帮助"><span class="nav-number">3.0.2.0.1.</span> <span class="nav-text">附加：gmond命令帮助</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 Gary Wu All Rights Reserved.</p>
	      
	      
  		   	<p id="copyRightCn">Gary Wu 保留所有权利</p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>














  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Gary Wu
          </div>
          <div class="panel-body">
            Copyright © 2018 Gary Wu All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>