<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>saltstack安装redis | Gary Wu | 运维架构师 - 从入门到放弃</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="高级运维,redis,saltstack,saltenv=prod">
    <meta name="description" content="目录结构  ├── modules │   ├── apache │   ├── haproxy │   ├── keepalived │   ├── mysql │   └── redis │       └── redis-install.sls └── redis-cluster     ├── files     │   └── redis-master.conf     └── red">
<meta name="keywords" content="高级运维,redis,saltstack,saltenv=prod">
<meta property="og:type" content="article">
<meta property="og:title" content="saltstack安装redis">
<meta property="og:url" content="https://wuyanteng.github.io/2017/10/25/saltstack安装redis/index.html">
<meta property="og:site_name" content="Gary Wu">
<meta property="og:description" content="目录结构  ├── modules │   ├── apache │   ├── haproxy │   ├── keepalived │   ├── mysql │   └── redis │       └── redis-install.sls └── redis-cluster     ├── files     │   └── redis-master.conf     └── red">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-10-25T09:29:34.781Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="saltstack安装redis">
<meta name="twitter:description" content="目录结构  ├── modules │   ├── apache │   ├── haproxy │   ├── keepalived │   ├── mysql │   └── redis │       └── redis-install.sls └── redis-cluster     ├── files     │   └── redis-master.conf     └── red">
    
        <link rel="alternate" type="application/atom+xml" title="Gary Wu" href="/atom.xml">
    
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/bingchuan.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/touxiang.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Gary Wu</h5>
          <a href="mailto:wuyanteng@foxmail.com" title="wuyanteng@foxmail.com" class="mail">wuyanteng@foxmail.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                所有文章
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/高级运维"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/wuyanteng" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://t.me/om_china" target="_blank" >
                <i class="icon icon-lg icon-link"></i>
                Telegram讨论组
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">saltstack安装redis</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入关键字来检索">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">saltstack安装redis</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-10-25T09:09:51.000Z" itemprop="datePublished" class="page-time">
  2017-10-25
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#redis-install-sls文件"><span class="post-toc-number">1.</span> <span class="post-toc-text">redis-install.sls文件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#redis-master-sls"><span class="post-toc-number">2.</span> <span class="post-toc-text">redis-master.sls</span></a></li></ol>
        </nav>
    </aside>


<article id="post-saltstack安装redis"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">saltstack安装redis</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-10-25 17:09:51" datetime="2017-10-25T09:09:51.000Z"  itemprop="datePublished">2017-10-25</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>目录结构</p>
</blockquote>
<pre><code>├── modules
│   ├── apache
│   ├── haproxy
│   ├── keepalived
│   ├── mysql
│   └── redis
│       └── redis-install.sls
└── redis-cluster
    ├── files
    │   └── redis-master.conf
    └── redis-master.sls
</code></pre><a id="more"></a>
<h4 id="redis-install-sls文件"><a href="#redis-install-sls文件" class="headerlink" title="redis-install.sls文件"></a>redis-install.sls文件</h4><pre><code>[root@linux-node1 redis]# cat redis-install.sls

redis-install:
  pkg.installed:
    - name: redis
</code></pre><h4 id="redis-master-sls"><a href="#redis-master-sls" class="headerlink" title="redis-master.sls"></a>redis-master.sls</h4><pre><code>[root@linux-node1 redis-cluster]# cat redis-master.sls

include:
  - modules.redis.redis-install     #include加载redis安装sls

redis-master-config:
  file.managed:
    - name: /etc/redis.conf
    - source: salt://redis-cluster/files/redis-master.conf
    - user: root
    - group: root
    - mode: 644
    - template: jinja          #启用jinja
    - defaluts:
      REDIS_MEM: 100m

redis-master-service:
  service.running:
    - name: redis
    - enable: True
    - watch:                          
      - file: redis-master-config   #如果redis配置变更则重启服务     
</code></pre><!-- more -->
<pre><code>在根环境的任意目录执行命令
salt \* state.sls redis-cluster.redis-master saltenv=prod

需要使用参数 saltenv=prod 手动指定根环境

因为saltstack是这样设计的，命令行指令运行，根目录是base(即配置文件指定的第一个目录)，所以需要使用参数 saltenv=prod

官方说明：
If no saltenv is specified, the minion config will be checked for an environment parameter and if found, it will be used. 
If none is found, base will be used. In prior releases, the minion config was not checked and base would always be assumed when the saltenv was not explicitly set.
</code></pre>
        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-10-25T09:29:34.781Z" itemprop="dateUpdated">2017-10-25 17:29:34</time>
</span><br>


        
        转载文章请注明出处！  <br>文章永久链接：<a href="/2017/10/25/saltstack安装redis/" target="_blank" rel="external">https://wuyanteng.github.io/2017/10/25/saltstack安装redis/</a><br><br>欢迎加入"运维中国"-Telegram讨论组：<a target="_blank" rel="external">https://t.me/om_china</a>
        
    </div>
    
    <footer>
        <a href="https://wuyanteng.github.io">
            <img src="https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/touxiang.jpg" alt="Gary Wu">
            Gary Wu
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/redis/">redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/saltenv-prod/">saltenv=prod</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/saltstack/">saltstack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/高级运维/">高级运维</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&title=《saltstack安装redis》 — Gary Wu&pic=https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/touxiang.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&title=《saltstack安装redis》 — Gary Wu&source=
目录结构

├── modules
│   ├── apache
│   ├── haproxy
│   ├── keepalived
│   ├── ..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《saltstack安装redis》 — Gary Wu&url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&via=https://wuyanteng.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/10/29/zabbix监控高级-进阶1/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">zabbix监控高级-进阶1</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/10/25/saltstack安装keepalived/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">saltstack安装keepalived</h4>
      </a>
    </div>
  
</nav>



    














</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们不一样
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE.png" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>很惭愧，在运维不归路上，一去不复返。。。始终不忘初心！我是GaryWu</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Gary Wu &copy; 2015 - 2018</span>
            <span>
                
                <a href="https://wuyanteng.github.io" target="_blank">博客由Hexo强力驱动</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&title=《saltstack安装redis》 — Gary Wu&pic=https://raw.githubusercontent.com/wuyanteng/wuyanteng.github.io/master/images/touxiang.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&title=《saltstack安装redis》 — Gary Wu&source=
目录结构

├── modules
│   ├── apache
│   ├── haproxy
│   ├── keepalived
│   ├── ..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《saltstack安装redis》 — Gary Wu&url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/&via=https://wuyanteng.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://wuyanteng.github.io/2017/10/25/saltstack安装redis/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACLElEQVR42u3aQXLjMAwEQP//08kDdmPPAHZSolqnVKyi2TzAIIDHI36+nj7J++23PD7xYGBgXJaRbDH5/08rJxv9d836+DAwMG7AeL6JhDQDP38nPyAMDAyM9uufb6t9HwMDA2MWcN8VLv/4dwMDA+NSjOQSm1xNn4fmdoWP3MUxMDAuyMir7r//90f6GxgYGJdifJVPu84s+at3hYGBcTQjD3CzMYs8QWwDLgYGxj0ZRWGrbBXk6+dHUM+UYWBgXJyRh7xNqN18moMxMDDOY+RLJwE0HyPLQ+rqFwMDA+MIRptlzcB50W04ZoGBgXEDRjLi0BbINpfYNiXFwMC4MyMPvjkpCe7DUiAGBsahjPbr2wvt7P2kGPefchsGBsahjPxKOQuL++GwIgRjYGAcytiUtzZtgNkl9kVui4GBcWNGW5KbNRtmLdIow8XAwLg4472DF0k7oS23DUcrMDAwDmW0WVbe7MxTxvYi/WLwAgMD4yBGW/aajXwlmLxt8GNSiIGBcTRjXxTbpKH58RUzIxgYGDdg7Acm8gNKxr/qYQsMDIzjGMmltG0A1HMfizUxMDBOZcwK/W04ng2TFQ0GDAyMoxn7a2e73Vl7oBi2wMDAOJTRBs1ZQT8pn+XX2hflNgwMjEMZ72oGbA5isz4GBgZG2+DcN0TbMI2BgYExS+PacYr2mN4WcDEwMC7CaEdLo6UXx9EmlxgYGGczNiEvD9N5Y6BtD2BgYBzN+AYaYkup/jcxmAAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '经检测,你已离开...';
            clearTimeout(titleTime);
        } else {
            document.title = '欢迎回来...';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
